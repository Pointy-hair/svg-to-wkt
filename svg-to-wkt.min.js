(function(){var a="http://www.w3.org/2000/svg",b={};b.PRECISION=3,b.DENSITY=1,b.convert=function(a){if(_.isUndefined(a)||_.isEmpty(a.trim()))throw new Error("Empty XML.");var c,d=[];a=a.replace(/\r\n|\r|\n|\t/g,"");try{c=$($.parseXML(a))}catch(e){throw new Error("Invalid XML.")}return c.find("polygon").each(function(a,c){d.push(b.polygon($(c).attr("points")))}),c.find("polyline").each(function(a,c){d.push(b.polyline($(c).attr("points")))}),c.find("line").each(function(a,c){d.push(b.line(parseFloat($(c).attr("x1")),parseFloat($(c).attr("y1")),parseFloat($(c).attr("x2")),parseFloat($(c).attr("y2"))))}),c.find("rect").each(function(a,c){d.push(b.rect(parseFloat($(c).attr("x")),parseFloat($(c).attr("y")),parseFloat($(c).attr("width")),parseFloat($(c).attr("height"))))}),c.find("circle").each(function(a,c){d.push(b.circle(parseFloat($(c).attr("cx")),parseFloat($(c).attr("cy")),parseFloat($(c).attr("r"))))}),c.find("ellipse").each(function(a,c){d.push(b.ellipse(parseFloat($(c).attr("cx")),parseFloat($(c).attr("cy")),parseFloat($(c).attr("rx")),parseFloat($(c).attr("ry"))))}),c.find("path").each(function(a,c){d.push(b.path($(c).attr("d")))}),"GEOMETRYCOLLECTION("+d.join(",")+")"},b.line=function(a,b,c,d){return"LINESTRING("+a+" "+-b+","+c+" "+-d+")"},b.polyline=function(a){var b=_.map(a.trim().split(" "),function(a){return a=a.split(","),a[1]=-a[1],a.join(" ")});return"LINESTRING("+b.join()+")"},b.polygon=function(a){var b=_.map(a.trim().split(" "),function(a){return a=a.split(","),a[1]=-a[1],a.join(" ")});return b.push(b[0]),"POLYGON(("+b.join()+"))"},b.rect=function(a,b,c,d){var e=[];return _.isNumber(a)||(a=0),_.isNumber(b)||(b=0),e.push(String(a)+" "+String(-b)),e.push(String(a+c)+" "+String(-b)),e.push(String(a+c)+" "+String(-b-d)),e.push(String(a)+" "+String(-b-d)),e.push(String(a)+" "+String(-b)),"POLYGON(("+e.join()+"))"},b.circle=function(a,c,d){var f="POLYGON((",g=[],h=2*Math.PI*d,i=Math.round(h*b.DENSITY),j=360/i;return _(i).times(function(b){var f=j*b*(Math.PI/180),h=e(a+d*Math.cos(f)),i=e(c+d*Math.sin(f));g.push(String(h)+" "+String(-i))}),g.push(g[0]),f+g.join()+"))"},b.ellipse=function(a,c,d,f){var g="POLYGON((",h=[],i=2*Math.PI*Math.sqrt((Math.pow(d,2)+Math.pow(f,2))/2),j=Math.round(i*b.DENSITY),k=360/j;return _(j).times(function(b){var g=k*b*(Math.PI/180),i=e(a+d*Math.cos(g)),j=e(c+f*Math.sin(g));h.push(String(i)+" "+String(-j))}),h.push(h[0]),g+h.join()+"))"},b.path=function(a){var b=_.map(a.trim().match(/[^z|Z]+[z|Z]/g),function(a){return c(a.trim()+"z")});if(_.isEmpty(b)){var e=c(a);return"LINESTRING("+d(e).join()+")"}var f=[];return _.each(b,function(a){f.push("("+d(a).join()+")")}),"POLYGON("+f.join()+")"};var c=function(b){var c=document.createElementNS(a,"path");return c.setAttributeNS(null,"d",b),c},d=function(a,c){c=c||!1;var d=[],f=a.getTotalLength(),g=Math.round(f*b.DENSITY);return _(g+1).times(function(b){var c=a.getPointAtLength(f*b/g);d.push(String(e(c.x))+" "+String(e(-c.y)))}),c&&d.push(d[0]),d},e=function(a){var c=Math.pow(10,b.PRECISION);return Math.round(a*c)/c};this.SVGtoWKT=b}).call(this);